#!/bin/env node

require('babel/register');

console.log('\nStarting HomeAway...\n');

var NODE_PORT = 80;

var mongoose = require('mongoose');
mongoose.connect('mongodb://admin:iDcRtD2cRVs0uDi2@cluster0-shard-00-00-xsinv.mongodb.net:27017,cluster0-shard-00-01-xsinv.mongodb.net:27017,cluster0-shard-00-02-xsinv.mongodb.net:27017/admin?ssl=true&replicaSet=Cluster0-shard-0&authSource=admin');
var connection = mongoose.connection;

connection.on('error', function() {
  console.log('  Failed to connect to MongoDB. Make sure mongod is running and check your connectivity.');
  process.exit(0);
});

connection.on('open', function() {
  console.log('  Connected to MongoDB.\n');
  var server = require('../server/server');
  server.listen(NODE_PORT, function() {
    console.log('\nHomeAway is live on port ' + NODE_PORT + '\n');
  });
});

process.on('SIGINT', function() {
  connection.close(function() {
    process.exit(0);
  });
});
